<!-- MARK: top -->

<div class="top">
	<div class="controls">
		<button class="control-btn theme" (click)="reset()">
			Reset
			<span class="material-symbols-outlined">format_color_reset</span>
		</button>

		<button class="control-btn theme" (click)="rotate()">
			Rotate
			<span class="material-symbols-outlined">rotate_90_degrees_cw</span>
		</button>

		<button class="control-btn theme" (click)="borders()">
			Borders
			<span class="material-symbols-outlined">pageless</span>
		</button>

		<p class="label-top">Color functions</p>

		<form [formGroup]="form" class="form">
			<label for="startColor">
				Start color:
				<input
					type="color"
					class="theme"
					formControlName="startColor"
					id="startColor"
					value="#ffffff"
				/>
			</label>

			<label for="endColor">
				End color:
				<input
					type="color"
					class="theme"
					formControlName="endColor"
					id="endColor"
					value="#0000ff"
				/>
			</label>
		</form>
	</div>

	<p class="label-left">Interpolation spaces</p>

	<div
		#table
		class="table"
		[style.gridTemplateColumns]="
			'min-content repeat(' + (columnCount() - 1) + ', 1fr)'
		"
		[style.gridTemplateRows]="
			'min-content repeat(' + (rowCount() - 1) + ', 1fr)'
		"
	>
		<div></div>

		@for (space of constants.allColorSpaces; track $index) {
			<button
				class="color-stop-btn function"
				[class.polar]="['hsl', 'hwb', 'lch', 'oklch'].includes(space)"
				[attr.data-color-stop-space]="'data-color-stop-space-' + space"
				(click)="removeColorStop(space)"
			>
				{{ getColorFunctionLabel(space) }}
			</button>
		}

		@for (
			interpolationSpace of constants.allInterpolationSpaces;
			track $index
		) {
			<button
				class="interpolation-space-btn interpolation"
				[class.polar]="
					['hsl', 'hwb', 'lch', 'oklch'].includes(interpolationSpace)
				"
				[attr.data-interpolation-space]="
					'data-interpolation-space-' + interpolationSpace
				"
				(click)="removeColorInterpolationSpace(interpolationSpace)"
			>
				{{ interpolationSpace | uppercase }}
			</button>

			@for (space of constants.allColorSpaces; track $index) {
				<div
					class="gradient"
					[attr.data-color-stop-space]="'data-color-stop-space-' + space"
					[attr.data-interpolation-space]="
						'data-interpolation-space-' + interpolationSpace
					"
					[style.background]="getGradient(interpolationSpace, space)"
					[style.border]="showBorders ? 'solid black' : null"
					[style.border-width]="showBorders ? '0 1px 1px 0' : null"
				></div>
			}
		}
	</div>
</div>

<p class="note">
	<span>
		All polar color spaces displayed here (HSL, HWB, LCH and OKLCH) use "shorter
		hue", the default hue interpolation method. The other three possible values
		are not listed here as they have specific use cases and are likely not what
		you require for general styling. For more info, visit
	</span>
	<a
		href="https://developer.mozilla.org/en-US/docs/Web/CSS/hue-interpolation-method"
		target="_blank"
	>
		<span>this link</span>
	</a>
	<span>.</span>
</p>

<!-- MARK: bottom -->

<div class="bottom">
	<p class="code-box">
		<span>background: linear-gradient(</span>
		<span class="direction">&lt;direction&gt;</span>
		<span>&nbsp;in&nbsp;</span>
		<span class="interpolation">&lt;interpolation-space&gt;</span>
		<span>,&nbsp;</span>
		<span class="function">&lt;color-stop-fn-1&gt;</span>
		<span>,&nbsp;</span>
		<span class="function">&lt;color-stop-fn-2&gt;</span>
		<span>);</span>

		<br />

		<span>background: linear-gradient(</span>
		<span class="direction">to right</span>
		<span>&nbsp;in&nbsp;</span>
		<span class="interpolation">oklab</span>
		<span>,&nbsp;</span>
		<span class="function polar">hsl()</span>
		<span>,&nbsp;</span>
		<span class="function polar">hsl()</span>
		<span>);</span>
	</p>

	<ol class="list-lvl-1">
		<li class="list-headline">TL;DR</li>
		<ol class="list-lvl-2">
			<li class="list-item">
				Define your color stops using a standard color function;
				<code class="function">rgb()</code>
				<span>,&nbsp;</span>
				<code class="function">#hex</code>
				<span>,&nbsp;</span>
				<code class="function polar">hsl()</code>
				<span>&nbsp;or&nbsp;</span>
				<code class="function polar">hwb()</code>
				<span>.</span>
			</li>

			<li class="list-item">
				Test both
				<code class="interpolation">OKLAB</code>
				and
				<code class="interpolation polar">OKLCH</code>
				for interpolation space, compare the results and pick the one you
				prefer.
			</li>
		</ol>

		<li class="list-headline">Glossary</li>

		<div class="signs">
			<code class="engine">Rendering Engine = green</code>
			<code class="function">color function = lowercase pink</code>
			<code class="interpolation">INTERPOLATION SPACE = uppercase purple</code>
			<code class="theme">rectangular color space = rectangular box</code>
			<code class="theme polar">polar color space = rounded box</code>
		</div>

		<ol class="list-lvl-2">
			<li class="list-item">
				Color space - a defined range of colors and a specific method for
				organizing and representing them numerically. A color space can be
				rectangular or polar (cylindrical).
			</li>

			<li class="list-item">
				Interpolation space - Color space used for generating mid-tones in
				gradient.
			</li>

			<li class="list-item">
				<span>
					Color function - Function that generates a color of gradient stop.
					Functions internally rely the same color spaces as the ones used for
					interpolation.
				</span>

				<span>
					Colors expressed in hexadecimal notation belong to the sRGB color
					space; the #hex format is just an alternative syntax for rgb() color
					function, representing the same rgb() values.
				</span>
			</li>

			<li class="list-item">
				<code class="engine">Blink</code>
				engine is a browser rendering engine of Chrome, Opera, Edge, Brave,
				Samsung Internet, DuckDuckGo Private Browser and many other.
				<code class="engine">Gecko</code>
				engine is used by Firefox and its forks.
				<code class="engine">WebKit</code>
				engine is used by all browsers running on iOS and by Safari on macOS.
			</li>
		</ol>

		<li class="list-headline">Interpolation spaces</li>
		<ol class="list-lvl-2">
			<li class="list-item">
				If no interpolation space is specified, gradients whose color stops are
				defined exclusively with the
				<code class="function">rgb()</code>
				<span>,&nbsp;</span>
				<code class="function">#hex</code>
				<span>,&nbsp;</span>
				<code class="function polar">hsl()</code>
				or
				<code class="function polar">hwb()</code>
				functions default to the
				<code class="interpolation">sRGB</code>
				interpolation space. For all other cases, the gradient defaults to the
				<code class="interpolation">OKLAB</code>
				interpolation space.
			</li>

			<li class="list-item">
				The interpolation space has a significantly greater impact on the
				resulting color gradient quality than the color stop function.
				Specifically:
				<ul class="list-lvl-3">
					<li>
						A chosen interpolation space will mostly yield consistent results
						across various color stop functions.
					</li>
					<li>
						Conversely, a specific color function will produce markedly
						different results depending on the interpolation space selected.
					</li>
				</ul>
				Therefore, selecting the appropriate interpolation color space is the
				primary factor in achieving the desired color gradient fidelity.
			</li>

			<li class="list-item">
				<code class="interpolation">OKLAB</code>
				and
				<code class="interpolation polar">OKLCH</code>
				are the only viable color interpolation spaces. All others are deemed
				low-quality or too inconsistent across variations in hue, lightness, and
				saturation, as well as between different browsers, making them
				unsuitable for reliable color work. On the other hand, while those color
				spaces offer the most reliable quality, they each present specific
				limitations; therefore, direct comparison between the two is essential
				to determine the optimal visual outcome.
			</li>

			<li class="list-item">
				If there is no difference in hue between color stops, both polar and
				rectangular interpolation should yield identical results.
			</li>

			<li class="list-item">
				Using any polar color space like
				<code class="interpolation polar">HSL</code>
				<span>,&nbsp;</span>
				<code class="interpolation polar">HWB</code>
				or
				<code class="interpolation polar">LCH</code>
				as the interpolation color space is strongly discouraged. These spaces
				frequently produce inconsistent mid-tone results when combined with any
				color function, and they often introduce unintended colors into
				gradients. The only polar color space that works consistently is
				<code class="interpolation polar">OKLCH</code>
				<span>.</span>
			</li>
		</ol>

		<li class="list-headline">Color functions</li>
		<ol class="list-lvl-2">
			<li class="list-item">
				Viable color functions for defining color stops are:
				<ul class="list-lvl-3">
					<li>
						In
						<code class="interpolation polar">OKLAB</code>
						interpolation:
						<code class="function">rgb()</code>
						<span>,&nbsp;</span>
						<code class="function">#hex</code>
						<span>,&nbsp;</span>
						<code class="function polar">hsl()</code>
						<span>,&nbsp;</span>
						<code class="function polar">hwb()</code>
						<span>,&nbsp;</span>
						<code class="function">oklab()</code>
						<span>,&nbsp;</span>
						<code class="function polar">oklch()</code>
						<span>.</span>
					</li>

					<li>
						In
						<code class="interpolation polar">OKLCH</code>
						interpolation:
						<code class="function">rgb()</code>
						<span>,&nbsp;</span>
						<code class="function">#hex</code>
						<span>,&nbsp;</span>
						<code class="function polar">hsl()</code>
						<span>,&nbsp;</span>
						<code class="function polar">hwb()</code>
						<span>.</span>
					</li>
				</ul>
			</li>

			<li class="list-item">
				All others functions either don't work as they're supposed to or are
				incosistent across browsers, or both.
			</li>
		</ol>

		<li class="list-headline">Additional observations</li>
		<ol class="list-lvl-2">
			<li class="list-item">
				<code class="engine">Gecko</code>
				browsers can't properly render conic gradients. Colors are fine, but the
				gradient has too sharp hue steps.
			</li>

			<li class="list-item">
				<code class="engine">Blink</code>
				browsers can't properly render gradients which use the same
				<code class="interpolation polar">OKLCH</code>
				for interpolation and
				<code class="function polar">oklch()</code>
				as color function.
			</li>

			<li class="list-item">
				<code class="engine">Blink</code>
				and
				<code class="engine">WebKit</code>
				browsers with
				<code class="interpolation polar">OKLCH</code>
				interpolation add unwanted extra colors to mid-tones of the gradient if
				one of the color stops is a greyscale color.
				<div class="blue-bug">
					<div class="oklab">oklab</div>
					<div class="oklch">oklch</div>
				</div>
			</li>

			<li class="list-item">
				<span>
					Gradients spanning large hue differences (like a transition from light
					pink to blue) vary significantly based on whether rectangular (e.g.,
				</span>
				<code class="interpolation">OKLAB</code>
				<span>) or polar (e.g.,</span>
				<code class="interpolation polar">OKLCH</code>
				<span>) color interpolation is used.</span>
				<ul class="list-lvl-3">
					<li>
						<span>Rectangular Interpolation (</span>
						<code class="interpolation">OKLAB</code>
						<span>) -</span>
						<span>
							Rectangular color spaces interpolate along a straight line across
							the color wheel. This path often passes near the achromatic
							center, causing a significant loss of saturation (a "graying out"
							or muddying) in the mid-tones of the gradient, especially with
							complementary colors. In the pink-to-blue example, the blue
							component tends to dominate the final gradient appearance.
						</span>
					</li>
					<li>
						<span>Polar Interpolation (</span>
						<code class="interpolation polar">OKLCH</code>
						<span>) -</span>
						<span>
							Polar color spaces interpolate in a circular manner around the hue
							wheel. This method is better at preventing desaturation observed
							in rectangular methods. However, this approach introduces
							additional hues (like pink, magenta, and purple in the example)
							into the mid-tones, which can result in a more complex color
							trajectory.
						</span>
					</li>
					<li>
						Both interpolation methods are considered viable, and the choice
						between them ultimately depends on the specific design requirements
						of the gradient.
					</li>
				</ul>
			</li>
			<div class="lightpink-bug">
				<div class="oklab">oklab</div>
				<div class="oklch">oklch</div>
				<div class="color-wheel">
					<p class="oklch-label">oklch</p>
					<p class="oklab-label">oklab</p>
					<svg>
						<circle
							r="2"
							cx="50%"
							cy="50%"
							stroke="black"
							fill="white"
							stroke-width="2"
						/>
						<path
							d="m150,100 l-132,125"
							style="fill: none; stroke: black; stroke-width: 3"
						/>
						<path
							d="m150,100 q-90,-50 -132,125"
							style="fill: none; stroke: black; stroke-width: 3"
						/>
					</svg>
				</div>
				<p class="note">
					This color wheel provides a simplified illustration, yet effectively
					demonstrates the distinction between polar and rectangular
					interpolation.
				</p>
			</div>
		</ol>

		<li class="list-headline">Hopes for the future</li>
		<ol class="list-lvl-2">
			<li class="list-item">
				<code class="engine">Blink</code>
				and
				<code class="engine">WebKit</code>
				properly render mid-tones in
				<code class="interpolation polar">OKLCH</code>
				interpolation, without adding extra colors.
			</li>
			<li class="list-item">
				<code class="engine">Gecko</code>
				doing the same with
				<code class="function">color("xyz-d65")</code>
				color function in
				<code class="interpolation polar">OKLCH</code>
				interpolation.
			</li>
			<li class="list-item">
				Once either of these implementations are fixed, we will have a
				consistent, cross-engine solution for perceptually uniform color
				rendering.
			</li>
			<li class="list-item">BUT...</li>
			<li class="list-item">
				Either of those will only provide a unified solution for standard gamut
				displays. For wide gamut displays, we need to wait until
				<code class="engine">Blink</code>
				and
				<code class="engine">WebKit</code>
				fix mid-tones interpolation in
				<code class="interpolation polar">OKLCH</code>
				when using
				<code class="function">oklab()</code>
				and
				<code class="function polar">oklch()</code>
				color functions.
			</li>
			<li class="list-item">
				At that point, standard gamut color functions like
				<code class="function">rgb()</code>
				or
				<code class="function polar">hsl()</code>
				can finally be phased out in favor of wide gamut color functions like
				<code class="function">oklab()</code>
				and
				<code class="function polar">oklch()</code>
				, enabling richer and more accurate color representation.
			</li>
		</ol>

		<li class="list-headline">Environment</li>
		<ol class="list-lvl-2">
			<li class="list-item">
				All observations tested on a standard color gamut display.
			</li>
			<p style="font-weight: bold; color: red">FIREFOX</p>
			<p style="font-weight: bold; color: red">SAFARI</p>
		</ol>
	</ol>
</div>
